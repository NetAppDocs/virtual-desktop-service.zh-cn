= 概述
:allow-uri-read: 




== 概述

虚拟桌面服务（ Virtual Desktop Service ， VDS ）可以克隆现有虚拟机（ VM ）。此功能旨在随着定义的用户数增加或更多服务器添加到可用资源池而自动提高服务器单元数可用性。

管理员可以通过两种方式在 VDS 中使用克隆：

. 按需自动从现有客户端服务器创建新服务器
. 主动自动创建新的客户端服务器，以便根据合作伙伴定义和控制的规则自动扩展资源




== 克隆以添加其他共享服务器

克隆是现有虚拟机的副本。克隆功能可以节省时间并帮助管理员进行扩展，因为安装子操作系统和应用程序可能非常耗时。通过克隆，您可以通过一个安装和配置过程创建多个虚拟机副本。这通常如下所示：

. 将所有所需的应用程序和设置安装到 TS 或 TSD 服务器上
. 导航到： " 工作空间 ">" 服务器部分 ">" 源服务器的齿轮图标 "> 单击 " 克隆 "
. 允许克隆进程运行（通常为 45-90 分钟）
. 最后一步激活克隆的服务器，将其放入 RDS 池中以接受新连接。克隆的服务器在克隆后可能需要单独配置，因此 VDS 会等待管理员手动将服务器置于轮换状态。


根据需要重复多次。image:Cloning-Servers.gif[""]

.为了增加共享会话主机环境中用户的容量，克隆会话主机是一个简单的过程，只需执行几个步骤即可。
. 选择要克隆的会话主机，确认当前没有任何用户登录到该计算机。
. 在 VDS 中，导航到目标客户端的 Workspace 。滚动到服务器部分，单击齿轮图标并选择克隆。此过程需要很长时间，并会使源计算机脱机。预计完成时间将超过 30 分钟。
+
image:clone1.png[""]
image:clone2.png[""]

. 此过程将关闭服务器，将服务器克隆到另一个映像，并将该映像按系统运行后再运行到客户的下一个 TS-# 。此服务器在服务器列表中显示为 _Type=Staged_ 和 _Status=激 活要求 _ 。
+
image:clone3.png[""]

. 登录到服务器并验证服务器是否已准备好投入生产。
+
image:clone4.png[""]

. 准备好后，单击激活将服务器添加到会话主机池中，以开始接受用户连接。
+
image:clone5.png[""]





== VDS 克隆过程定义

在任何克隆服务器操作下的 VDS > 部署 > 任务历史记录中详细介绍了分步过程。此过程包含 20 多个步骤，这些步骤从访问虚拟机管理程序开始克隆过程，到激活克隆的服务器结束。克隆过程包括以下关键步骤：

* 配置 DNS 并设置服务器名称
* 分配 StaticIP
* 添加到域
* 更新 Active Directory
* 更新 VDS 数据库（ CMGR1 上的 SQL 实例）
* 为克隆创建防火墙规则


除了任务历史记录之外，还可以在每个合作伙伴的虚拟桌面部署中的 CwVmAutomationService 日志中查看任何克隆过程的详细步骤。查看这些日志文件会记录下来 link:Troubleshooting.reviewing_vds_logs.html["此处"]。



== 自动创建新服务器

此 VDS 功能旨在随着定义的用户数量的增长自动提高服务器单元数量的可用性。

配对节点通过 VDS 定义和管理（link:https://manage.cloudworkspace.com[""]） > 客户端 > 概述– VM 资源 > 自动扩展。合作伙伴可以通过多个控件来启用 / 禁用自动扩展以及为每个客户端创建自定义规则，例如：数量 / 用户 / 服务器，每个用户额外的 RAM 以及每个 CPU 的用户数量。


NOTE: 上述假设已为整个虚拟桌面部署启用自动克隆。例如，要停止所有自动克隆，请使用 DCConfig ，在高级窗口中取消选中服务器创建 -> 自动克隆已启用。



=== 自动克隆过程何时运行？

如果将每日维护配置为运行，则会运行自动克隆过程。默认值为午夜，但可以编辑此值。日常维护的一部分是为每个资源池运行 " 更改资源 " 线程。更改资源线程根据池配置的用户数（可自定义；每个服务器可以是 10 ， 21 ， 30 等用户）确定所需的共享服务器数量。



== 按需自动创建新服务器

通过此 VDS 功能，可以自动将其他服务器 " 按需 " 克隆到可用资源池。

VDS 管理员登录到 VDS ，然后在组织或工作空间模块下找到特定客户端并打开概述选项卡。" 服务器 " 图块列出了所有服务器（ TSD1 ， TS1 ， D1 等）。要克隆任何单个服务器，只需单击服务器名称最右侧的代码并选择克隆选项即可。

通常，此过程需要大约一个小时。但是，持续时间取决于虚拟机的大小以及底层虚拟机管理程序的可用资源。请注意，要克隆的服务器需要重新启动，因此合作伙伴通常会在非工作时间或计划的维护时段执行。

克隆 TSData 服务器时，其中一个步骤是删除 c ： \Home ， c ： \Data 和 c ： \Pro 文件夹，使其不是任何重复文件。在这种情况下，克隆进程失败，删除这些文件时出现问题。此错误不明确。通常，这意味着克隆事件失败，因为存在打开的文件或进程。下次尝试，请禁用任何 AV （因为这可能会解释此错误）。
