---
sidebar: sidebar 
permalink: Deploying.GCP.vds_v5.4_prerequisites.html 
summary: GCP 和 VDS 前提条件 
---
= Google Compute Platform （ GCP ）和 VDS 前提条件




== GCP 和 VDS 要求和说明

本文档介绍使用 NetApp 虚拟桌面服务（ Virtual Desktop Service ， VDS ）部署远程桌面服务（ Remote Desktop Services ， RDS ）所需的要素。" 快速检查清单 " 简要列出了确保高效部署所需的组件和部署前步骤。本指南的其余部分将根据所做的配置选择详细介绍每个元素。

image:ReferenceArchitectureGCPRDS.png["宽度 = 75%"]



== 快速检查清单



=== GCP 要求

* GCP 租户
* GCP 项目
* 分配了所有者角色的服务帐户




=== 部署前信息

* 确定用户总数
* 确定 GCP 区域和分区
* 确定 Active Directory 类型
* 确定存储类型
* 确定会话主机 VM 映像或要求
* 评估现有的 GCP 和内部网络配置




== VDS 部署详细要求



=== 最终用户连接要求

.以下远程桌面客户端支持 GCP 中的 RDS ：
* link:https://docs.netapp.com/us-en/virtual-desktop-service/Reference.end_user_access.html#overview["适用于 Windows 的 NetApp VDS 客户端"]
+
** NetApp VDS Client for Windows 出站 URL 安全列表要求
+
*** api.cloudworkspace.com
*** vdsclient.app
*** api.vdsclient.app
*** bin.vdsclient.app


** 增强功能：
+
*** VDS 按需唤醒
*** ThinPrint 客户端和鼠标
*** 自助式密码重置
*** 自动服务器和网关地址协商
*** 全面的桌面和流式应用程序支持
*** 可用的自定义品牌
*** 用于自动部署和配置的安装程序交换机
*** 内置故障排除工具




* link:https://login.cloudworkspace.com/["NetApp VDS Web 客户端"]
* link:https://docs.microsoft.com/en-us/windows-server/remote/remote-desktop-services/clients/remote-desktop-clients["Microsoft RD 客户端"]
+
** Windows
** macOS
** ISO
** Android


* 第三方软件和 / 或瘦客户端
+
** 要求：支持 RD 网关配置






==== 存储层

在由 VDS 部署的 RDS 中，存储策略的设计目的是，在 AVD 会话 VM 上不会驻留任何永久性用户 / 公司数据。用户配置文件，用户文件和文件夹以及公司 / 应用程序数据的永久性数据托管在独立数据层上托管的一个或多个数据卷上。

FSLogix 是一种配置文件容器化技术，可通过在会话初始化时将用户配置文件容器（ VHD 或 VHDX 格式）挂载到会话主机来解决许多用户配置文件问题（如数据无序增长和登录速度较慢）。

由于采用这种架构，需要具备数据存储功能。此功能必须能够处理每天早晨 / 下午当大部分用户同时登录 / 注销时所需的数据传输。即使规模适中的环境也可能需要大量数据传输。数据存储层的磁盘性能是最终用户性能的主要变量之一，必须特别注意适当调整此存储的性能大小，而不仅仅是存储容量。通常，存储层的大小应支持每个用户 5-15 IOPS 。



==== 网络

* 必需： * 所有现有网络子网的清单，包括通过 VPN 对 GCP 项目可见的任何子网。此部署需要避免子网重叠。

通过 VDS 设置向导，您可以在计划内与现有网络集成时定义所需或必须避免的网络范围。

在部署期间确定用户的 IP 范围。根据最佳实践，仅支持专用范围内的 IP 地址。

.支持的选项包括以下，但默认为 /20 范围：
* 192.168.0.0 到 192.168.255.255
* 172.16.0.0 到 172.31.255.255
* 10.0.0.0 到 10.255.255.255




==== CMGR1

VDS 的某些独特功能，例如，节省成本的工作负载计划和实时扩展功能需要在组织和项目中具有管理功能。因此，在 VDS 设置向导自动化过程中会部署一个名为 CMGR1 的管理 VM 。除了 VDS 自动化任务之外，此 VM 还在 SQL 快速数据库，本地日志文件和一个名为 DCConfig 的高级配置实用程序中保存 VDS 配置。

.根据在 VDS 设置向导中所做的选择，此虚拟机可用于托管其他功能，包括：
* RDS 网关
* 一个 HTML 5 网关
* RDS 许可证服务器
* 域控制器




=== 部署向导中的决策树

在初始部署过程中，我们会回答一系列问题，以自定义新环境的设置。下面概述了要做出的主要决策。



==== GCP 区域

确定要托管 VDS 虚拟机的 GCP 区域。请注意，应根据与最终用户和可用服务之间的距离选择区域。



==== 数据存储

确定用户配置文件，单个文件和企业共享的数据放置位置。选项包括：

* 适用于 GCP 的 Cloud Volumes Service
* 传统文件服务器




== 现有组件的 NetApp VDS 部署要求



=== 使用现有 Active Directory 域控制器部署 NetApp VDS

此配置类型可扩展现有 Active Directory 域以支持 RDS 实例。在这种情况下， VDS 会将一组有限的组件部署到域中，以支持 RDS 组件的自动配置和管理任务。

.此配置需要：
* 一种现有 Active Directory 域控制器，可由 GCP VPC 网络上的 VM 访问，通常通过 VPN 或在 GCP 中创建的域控制器访问。
* 添加了加入域时对 RDS 主机和数据卷进行 VDS 管理所需的 VDS 组件和权限。部署过程需要具有域权限的域用户运行脚本，以创建所需的元素。
* 请注意，默认情况下， VDS 部署会为 VDS 创建的 VM 创建 VPC 网络。VPC 网络可以与现有 VPC 网络建立对等关系，也可以将 CMGR1 VM 移至已预先定义了所需子网的现有 VPC 网络。




==== 凭据和域准备工具

管理员必须在部署过程的某个时刻提供域管理员凭据。可以稍后创建，使用和删除临时域管理员凭据（部署过程完成后）。或者，在构建前提条件方面需要帮助的客户也可以使用域准备工具。



=== 使用现有文件系统部署 NetApp VDS

VDS 创建的 Windows 共享允许从 RDS 会话主机访问用户配置文件，个人文件夹和企业数据。默认情况下， VDS 将部署文件服务器，但如果您有现有文件存储组件，则 VDS 可以在 VDS 部署完成后将共享指向该组件。

.使用和现有存储组件的要求：
* 此组件必须支持 SMB v3
* 此组件必须与 RDS 会话主机加入同一 Active Directory 域
* 该组件必须能够公开一个 UNC 路径以供 VDS 配置使用—所有三个共享都可以使用一个路径，或者可以为每个共享指定单独的路径。请注意， VDS 将为这些共享设置用户级别权限，请确保已为 VDS 自动化服务授予相应的权限。




== 附录 A ： VDS 控制面板 URL 和 IP 地址

GCP 项目中的 VDS 组件与 Azure 中托管的 VDS 全局控制平面组件进行通信，包括 VDS Web 应用程序和 VDS API 端点。要进行访问，需要在端口 443 上安全列出以下基本 URI 地址，以便进行双向访问：

link:api.cloudworkspace.com[""]
link:autoprodb.database.windows.net[""]
link:vdctoolsapi.trafficmanager.net[""]
link:cjbootstrap3.cjautomate.net[""]

如果您的访问控制设备只能按 IP 地址安全列出，则应将以下 IP 地址列表列入安全列表。请注意， VDS 使用具有冗余公有 IP 地址的负载平衡器，因此此列表可能会随时间而变化：

13.67.190.243 13.67.215.62 13.89.50.122 13.67.227.115 13.67.227.230 13.67.227.22723.99.136.91 40.119.157 40.78.132.166 40.78.40.129.17 122.52.167 40.70.147.2 40.86.99.202 13.68.19.178 13.68.114.184 137.11.21.208.132.132.172.1320.21.208.1721.138.172.138.172.138.1720.21.208.138.1720.21.138.132.138.1720.21.202.138.138.138.138.138.213.620.1.238.138.138.138.138.138.138.138.138.138.217.21.208.138.138.138.138.138.217.21.208.138.138.138.138.17



=== 最佳性能因素

要获得最佳性能，请确保您的网络满足以下要求：

* 从客户端网络到已部署会话主机的 GCP 区域的往返（ RTT ）延迟应小于 150 毫秒。
* 当托管桌面和应用程序的 VM 连接到管理服务时，网络流量可能会超出国家 / 地区边界。
* 为了优化网络性能，我们建议会话主机的 VM 与管理服务位于同一区域。




=== 支持的虚拟机操作系统映像

由 VDS 部署的 RDS 会话主机支持以下 x64 操作系统映像：

* Windows Server 2019
* Windows Server 2016
* Windows Server 2012 R2

